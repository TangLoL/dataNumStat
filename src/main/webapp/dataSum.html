<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>DataShow</title>
		<link rel="stylesheet" href="css/bootstrap.min.css" />
		<script type="text/javascript" src="js/jquery-2.1.4.min.js" ></script>
		<script type="text/javascript" src="js/bootstrap.min.js" ></script>
	</head>
	<body>
		<ul id="myTab" class="nav nav-tabs">
			<li class="active">
				<a href="#home" data-toggle="tab">
					系统控制率
				</a>
			</li>
			<li>
				<a onclick="getdataProxy(2)" href="#ios2" data-toggle="tab">网综数据接入</a>
			</li>
			<li>
				<a onclick="getdataProxy(3)" href="#ios3" data-toggle="tab">WIFI采集数据</a>
			</li>
			<li>
				<a onclick="getdataProxy(4)" href="#ios4" data-toggle="tab">网综数据汇聚</a>
			</li>
			<li>
				<a onclick="getdataProxy(5)" href="#ios5" data-toggle="tab">数据五</a>
			</li>
		</ul>
		<div id="myTabContent" class="tab-content">
            <div class="tab-pane fade  in active" id="home">
                <h4><span id="time1" class="label label-info"></span></h4>
                <table id="table1" class="table table-striped table-bordered table-hover ">
                    <thead id="thead1">
                    <tr>
                        <th>城市</th>
                        <th>联通-总线路</th>
                        <th>联通-已控制</th>
                        <th>移动-总线路</th>
                        <th>移动-已控制</th>
                        <th>电信-总线路</th>
                        <th>电信-已控制</th>
                        <th>总共-总线路</th>
                        <th>总共-已控制</th>
                        <th>控制率</th>
                        <th>厂商</th>
                        <th>排名</th>
                    </tr>
                    </thead>
                    <tbody id="tbody1">

                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="ios2">
                <h4><span id="time2" class="label label-info"></span></h4>
                <table id="table2" class="table table-striped table-bordered table-hover ">
                    <thead id="thead2">
                    <tr>
                        <th>城市</th>
                        <th>固网</th>
                        <th>移网</th>
                        <th>网吧</th>
                        <th>wifi</th>
                        <th>勘察取证</th>
                        <th>厂商</th>
                    </tr>
                    </thead>
                    <tbody id="tbody2">

                    </tbody>
                </table>
                <form id="uploadform" hidden="true">
                    <input type="file" hidden="true" id="uploadButton">
                </form>
                <input hidden="hidden" type="button" onclick="upload()" class="btn-primary" value="上传文件"/>
            </div>
			<div class="tab-pane fade" id="ios3">
                <h4><span id="time3" class="label label-info"></span></h4>
				<table id="table3" class="table table-striped table-bordered table-hover ">
					<thead id="thead3">
                    <tr>
                        <th></th>
                        <th>锐安</th>
                        <th>太极</th>
                        <th>烽火</th>
                        <th>锐安</th>
                        <th>太极</th>
                        <th>烽火</th>
                        <th>太极</th>
                        <th>烽火</th>
                        <th>烽火</th>
                        <th>太极</th>
                        <th>太极</th>
                        <th>烽火</th>
                        <th>锐安</th>
                        <th>烽火</th>
                        <th>烽火</th>
                        <th>烽火</th>
                        <th>太极</th>
                        <th>太极</th>
                    </tr>
                    <tr>
                        <th>时间</th>
                        <th>郑州</th>
                        <th>开封</th>
                        <th>洛阳</th>
                        <th>平顶山</th>
                        <th>安阳</th>
                        <th>鹤壁</th>
                        <th>新乡</th>
                        <th>焦作</th>
                        <th>濮阳</th>
                        <th>许昌</th>
                        <th>漯河</th>
                        <th>三门峡</th>
                        <th>南阳</th>
                        <th>商丘</th>
                        <th>信阳</th>
                        <th>周口</th>
                        <th>驻马店</th>
                        <th>济源</th>
                    </tr>
					</thead>
					<tbody id="tbody3">
						
					</tbody>
				</table>
			</div>
            <div class="tab-pane fade" id="ios4">
                <input id="getMoreData"  onclick="getData(4,30)" type="button" class="btn btn-primary" value="获取更多">
                <span id="time4" class="label label-info"></span>
                <table id="table4" class="table table-striped table-bordered table-hover ">
                    <thead id="thead4">
                        <tr>
                            <th></th>
                            <th>锐安</th>
                            <th>太极</th>
                            <th>烽火</th>
                            <th>锐安</th>
                            <th>太极</th>
                            <th>烽火</th>
                            <th>太极</th>
                            <th>烽火</th>
                            <th>烽火</th>
                            <th>太极</th>
                            <th>太极</th>
                            <th>烽火</th>
                            <th>锐安</th>
                            <th>烽火</th>
                            <th>烽火</th>
                            <th>烽火</th>
                            <th>太极</th>
                            <th>太极</th>
                        </tr>
                        <tr>
                            <th>时间</th>
                            <th>郑州</th>
                            <th>开封</th>
                            <th>洛阳</th>
                            <th>平顶山</th>
                            <th>安阳</th>
                            <th>鹤壁</th>
                            <th>新乡</th>
                            <th>焦作</th>
                            <th>濮阳</th>
                            <th>许昌</th>
                            <th>漯河</th>
                            <th>三门峡</th>
                            <th>南阳</th>
                            <th>商丘</th>
                            <th>信阳</th>
                            <th>周口</th>
                            <th>驻马店</th>
                            <th>济源</th>
                        </tr>
                    </thead>
                    <tbody id="tbody4">

                    </tbody>
                </table>
            </div>
            <div class="tab-pane fade" id="ios5">
                <h4><span id="time5" class="label label-info"></span></h4>
				<table id="table5" class="table table-striped table-bordered table-hover ">
					<thead id="thead5">
					</thead>
					<tbody id="tbody5">
						
					</tbody>
				</table>
			</div>
		</div>
		<script>
			function upload() {
				$('#uploadButton').click();
			};
			function theadFactory(index){
				return $("#thead"+index);
			}
			function tbodyFactory(index){
				return $("#tbody"+index);
			}
			function stime(index) {
                return $("#time"+index);
            }
			var req=[false,false,false,false,false];
			var urls=["/springboot/NodeControlRate/getCurrentData","/springboot/wzdatain/showlist","/springboot/WifiDataUp/getData","/springboot/wzdatasum/getQuery"];
			function getdataProxy(index) {
                if(req[index]){
                    return;
                }
                getData(index);
            }
			function  getData(index,day) {
				var thead = theadFactory(index);
				var tbody = tbodyFactory(index);
				var time = stime(index);
				$.ajax({
					type: "post",
					url: urls[index-1],
					data: {"day":day},
					success:function (data) {
						console.log(data);
						if (data.length===0){
						    alert("无数据");
                            req[index]=true;
						    return;
						}
						if(index===1){
						    nodecontrol(thead,tbody,time,data);
						}
						if (index===3){
//                        	formateWifiDataUp(thead,tbody,time,data);
                            wzCluster(thead,tbody,time,data,day);
                        }
                        if (index===2){
						    WZDatain(thead,tbody,time,data);
						}
						if (index===4){
                            wzCluster(thead,tbody,time,data,day);
                        }
						addCss(tbody);
						if (day!==undefined){
						    $("#getMoreData").remove();
                        }
						req[index]=true;
                    },
					error:function (data) {
						alert(data);
                    }
				});
            }
            function formateWifiDataUp(head,body,time,data) {
                for(var item in data){
                    $(time).text(data[item]["time"]);
                    body.append("<tr><td>"+data[item]["unit"]+"</td><td>"+data[item]["report"]+"</td><td>"+data[item]["factory"]+"</td></tr>");
                }
            }
            function nodecontrol(head,body,time,data) {
                for(var item in data){
                    $(time).text(data[item]["time"]);
                    body.append("<tr><td>"+data[item]["unit"]+"</td><td>"+data[item]["unicomCurrent"]+"</td><td>"+data[item]["unicomControlled"]
                        +"</td><td>"+data[item]["mobileCurrent"]+"</td><td>"+data[item]["mobileControlled"]+"</td><td>"+data[item]["telecomCurrent"]
                        +"</td><td>"+data[item]["telecomControlled"]+"</td><td>"+data[item]["sumCurrent"]+"</td><td>"+data[item]["sumControlled"]
                        +"</td><td>"+data[item]["controlRate"]+"</td><td>"+data[item]["factory"]+"</td><td>"+data[item]["rank"]+"</td></tr>");
                }
            }
            function WZDatain(head,body,time,data) {
                for(var item in data){
                    $(time).text(data[item]["time"]);
                    body.append("<tr><td>"+data[item]["unit"]+"</td><td>"+data[item]["fixedNetWork"]+"</td><td>"
                        +data[item]["mobileInternet"]+"</td><td>"+data[item]["netBar"]+"</td><td>"+data[item]["wifi"]
                        +"</td><td>"+data[item]["obtain"]
                        +"</td><td>"+data[item]["factory"]+"</td></tr>");
                }
            }
            function wzCluster(head,body,time,data,day) {
			    $(body).empty();
			    var length = data.length;
			    var timedate=data[length-1]["date"];
			    timedate=new Date(timedate.substr(0,4)+" "+timedate.substr(4,2)+" "+timedate.substr(6,2));

			    if (day===undefined)
                    timedate.setDate(timedate.getDate()-10);
			    else
                    timedate.setDate(timedate.getDate()-30)
                $(time).text(date.toLocaleString().substr(0,10).replace(/\//g,"-")+"--"+data[length-1]["date"]);
                for (var item=length-1;item>=0 ;item--){
                    body.append("<tr><td>"+data[item]["date"]+"</td><td>"+data[item]["zhengzhou"]+"</td><td>"+data[item]["kaifeng"]+
                        "</td><td>"+data[item]["luoyang"]+"</td><td>"+data[item]["pingdings"]+"</td><td>"+data[item]["anyang"]+
                        "</td><td>"+data[item]["hebi"]+"</td><td>"+data[item]["xinxiang"]+"</td><td>"+data[item]["jiaozuo"]+
                        "</td><td>"+data[item]["puyang"]+"</td><td>"+data[item]["xuchang"]+"</td><td>"+data[item]["luohe"]+
                        "</td><td>"+data[item]["sanmenxia"]+"</td><td>"+data[item]["nanyang"]+"</td><td>"+data[item]["shangqiu"]+
                        "</td><td>"+data[item]["xinyang"]+"</td><td>"+data[item]["zhoukou"]+"</td><td>"+data[item]["zhumadian"]+
                        "</td><td>"+data[item]["jiyuan"]+"</td></tr>");
                }
            }
            function addCss(body) {
			    body=body[0].children;
                for (var i in body){
                    var tr =body[i].children;
                    for(var j=0;j<$(tr).length;j++){
                        var th = tr[j];
                        if ($(th).text()==="否")
                            $(th).addClass("danger");
                    }
                }
            }
			$(function(){
			    $.ajax({
                    type: "post",
                    url: "/springboot/WifiDataUp/getOne",
                    data: {"time": "20170012"},
                    success:function (data) {
                        console.log(data);
                    },
                    error:function (data) {
                      console.log(data);
                    }
                });
				$('#uploadButton').change(function() {
					var formData = new FormData($("#uploadform"));
					var file = this.files[0];
					formData.set("file",file);
                    formData.append("name","zyf");
                    console.log(formData.values());
					$.ajax({
						type: "post",
						url: "/springboot/upload/file",
						data: formData,
						async: true,
						cache: false,
						contentType: false,
						processData: false,
						success: function(data) {
							$('#uploadform')[0].reset();
							alert(data);
						},
						error: function(data) {
							alert("上传失败");
						}
					});
				});
			    getData(1);
			})
		</script>
	</body>
</html>
